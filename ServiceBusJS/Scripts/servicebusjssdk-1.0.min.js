function BrokeredMessage(a,b){this.body=a;this.properties=b}function SubscriptionClient(a){a.name=a.name+"/subscriptions/"+a.subscription;if(a.subscription==null){throw"'supbsription' of specified configuration object property must not be empy!"}var b=new QueueClient(a);this.receiveMessage=function(c){b.receiveMessage(c)},this.peekLockMessage=function(c){b.peekLockMessage(c)},this.abandonMessage=function(d,c){b.abandonMessage(d,c)},this.completeMessage=function(d,c){b.completeMessage(d,c)}}function TopicClient(b){var a=new QueueClient(b);this.sendMessage=function(c,d){a.sendMessage(c,d)}}function QueueClient(config){var m_EntityName="Please provide the queue name. For example 'customer/orders'";var m_Timeout=60;var m_ServiceNamespace;var m_SasKey="provide SAS key";var m_SasKeyName="provide the SAS key name.";m_ServiceNamespace=config.namespace;if(config.name!=null){m_EntityName=config.name}if(config.sasKey!=null){m_SasKey=config.sasKey}if(config.sasKeyName!=null){m_SasKeyName=config.sasKeyName}if(config.timeOut!=null){m_Timeout=config.timeOut}if(config.contentType==null){m_ContentType="application/json"}function MessagingResult(result,httpStatusCode,msg){this.result=result;this.httpStatusCode=httpStatusCode;this.brokeredMessage=msg}var getUri=function(entityName,head){var entityUri="https://"+m_ServiceNamespace+".servicebus.windows.net/"+entityName;var uri;if(head==null){uri=entityUri+"/messages/?timeout="+m_Timeout}else{uri=entityUri+"/messages/"+head+"/?timeout="+m_Timeout}return uri};var getToken=function(entityPath){var uri="http://"+m_ServiceNamespace+".servicebus.windows.net/"+entityPath;var endocedResourceUri=encodeURIComponent(uri);var t0=new Date(1970,1,1,0,0,0,0);var t1=new Date();var expireInSeconds=expireInSeconds=(Date.now()/1000)+3600;var plainSignature=utf8Encode(endocedResourceUri+"\n"+expireInSeconds);var hash=CryptoJS.HmacSHA256(plainSignature,m_SasKey);var base64HashValue=CryptoJS.enc.Base64.stringify(hash);var token="SharedAccessSignature sr="+endocedResourceUri+"&sig="+encodeURIComponent(base64HashValue)+"&se="+expireInSeconds+"&skn="+m_SasKeyName;return token};var utf8Encode=function(s){for(var c,i=-1,l=(s=s.split("")).length,o=String.fromCharCode;++i<l;s[i]=(c=s[i].charCodeAt(0))>=127?o(192|(c>>>6))+o(128|(c&63)):s[i]){}return s.join("")};var utf8Decode=function(s){for(var a,b,i=-1,l=(s=s.split("")).length,o=String.fromCharCode,c="charCodeAt";++i<l;((a=s[i][c](0))&128)&&(s[i]=(a&252)==192&&((b=s[i+1][c](0))&192)==128?o(((a&3)<<6)+(b&63)):o(128),s[++i]="")){}return s.join("")};var getResponseHeaders=function(headerStr){var headers={};if(!headerStr){return headers}var headerPairs=headerStr.split("\u000d\u000a");for(var i=0;i<headerPairs.length;i++){var headerPair=headerPairs[i];var index=headerPair.indexOf("\u003a\u0020");if(index>0){var key=headerPair.substring(0,index);var val=headerPair.substring(index+2);headers[key]=val}}return headers};this.sendMessage=function(message,callback){var body=JSON.stringify(message.body);var props=message.properties;var securityToken=getToken(m_EntityName);var sendUri=getUri(m_EntityName);var xmlHttpRequest=new XMLHttpRequest();xmlHttpRequest.open("POST",sendUri,true);xmlHttpRequest.setRequestHeader("Content-Type",m_ContentType);xmlHttpRequest.setRequestHeader("Authorization",securityToken);if(props!=null){for(var i=0;i<props.length;i++){if(props[i].Name==null||props[i].Value==null){if(callback!=null){messagingResult=new MessagingResult("The list of properties must contain pair values {'Name': ***, 'Value': ***}",this.status,null,this.response);callback(messagingResult)}}else{xmlHttpRequest.setRequestHeader(props[i].Name,props[i].Value)}}}xmlHttpRequest.onreadystatechange=function(){if(this.readyState==4){var messagingResult;if(this.status==201){messagingResult=new MessagingResult("Success",this.status,null,this.response)}else{messagingResult=new MessagingResult("Failure",this.status,null,this.response)}if(callback!=null){callback(messagingResult)}}};xmlHttpRequest.send(body)},this.receiveMessage=function(callback){var securityToken=getToken(m_EntityName);var xmlHttpRequest=new XMLHttpRequest();var receiveUri=getUri(m_EntityName,"head");xmlHttpRequest.open("DELETE",receiveUri,true);xmlHttpRequest.setRequestHeader("Authorization",securityToken);xmlHttpRequest.onreadystatechange=function(){if(this.readyState==4){var messagingResult;if(this.status==200){var allHeaders=getResponseHeaders(this.getAllResponseHeaders());allHeaders.brokerProperties=eval("("+this.getResponseHeader("BrokerProperties")+")");messagingResult=new MessagingResult("Success",this.status,new BrokeredMessage(this.response,allHeaders))}else{if(this.status==204){messagingResult=new MessagingResult("Empty",this.status,new BrokeredMessage(this.response))}else{messagingResult=new MessagingResult("Failure",this.status,new BrokeredMessage(this.response))}}callback(messagingResult)}};xmlHttpRequest.send(null)},this.peekLockMessage=function(callback){var securityToken=getToken(m_EntityName);var uri=getUri(m_EntityName,"head");var xmlHttpRequest=new XMLHttpRequest();xmlHttpRequest.open("POST",uri,true);xmlHttpRequest.setRequestHeader("Authorization",securityToken);xmlHttpRequest.onreadystatechange=function(){if(this.readyState==4){var messagingResult;if(this.status==201){var allHeaders=getResponseHeaders(this.getAllResponseHeaders());allHeaders.brokerProperties=eval("("+this.getResponseHeader("BrokerProperties")+")");messagingResult=new MessagingResult("Success",this.status,new BrokeredMessage(this.response,allHeaders))}else{if(this.status==204){messagingResult=new MessagingResult("Empty",this.status,new BrokeredMessage(this.response))}else{messagingResult=new MessagingResult("Failure",this.status,new BrokeredMessage(this.response))}}if(callback!=null){callback(messagingResult)}}};xmlHttpRequest.send(null)},this.abandonMessage=function(lockUri,callback){var xmlHttpRequest=new XMLHttpRequest();var securityToken=getToken(m_EntityName);xmlHttpRequest.open("PUT",lockUri,true);xmlHttpRequest.setRequestHeader("Authorization",securityToken);xmlHttpRequest.onreadystatechange=function(){if(this.readyState==4){var messagingResult;if(this.status==200){messagingResult=new MessagingResult("Success",this.status,new BrokeredMessage(this.response))}else{messagingResult=new MessagingResult("Failure",this.status,new BrokeredMessage(this.response))}callback(messagingResult)}};xmlHttpRequest.send(null)},this.completeMessage=function(lockUri,callback){var securityToken=getToken(m_EntityName);var xmlHttpRequest=new XMLHttpRequest();xmlHttpRequest.open("DELETE",lockUri,true);xmlHttpRequest.setRequestHeader("Authorization",securityToken);xmlHttpRequest.onreadystatechange=function(){if(this.readyState==4){var messagingResult;if(this.status==200){messagingResult=new MessagingResult("Success",this.status,new BrokeredMessage(this.response))}else{messagingResult=new MessagingResult("Failure",this.status,new BrokeredMessage(this.response))}callback(messagingResult)}};xmlHttpRequest.send(null)}}var CryptoJS=CryptoJS||function(t,s){var w={},v=w.lib={},n=v.Base=function(){function b(){}return{extend:function(e){b.prototype=this;var f=new b;e&&f.mixIn(e);f.$super=this;return f},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var f in e){e.hasOwnProperty(f)&&(this[f]=e[f])}e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),p=v.WordArray=n.extend({init:function(b,e){b=this.words=b||[];this.sigBytes=e!=s?e:4*b.length},toString:function(b){return(b||j).stringify(this)},concat:function(f){var g=this.words,h=f.words,i=this.sigBytes,f=f.sigBytes;this.clamp();if(i%4){for(var e=0;e<f;e++){g[i+e>>>2]|=(h[e>>>2]>>>24-8*(e%4)&255)<<24-8*((i+e)%4)}}else{if(65535<h.length){for(e=0;e<f;e+=4){g[i+e>>>2]=h[e>>>2]}}else{g.push.apply(g,h)}}this.sigBytes+=f;return this},clamp:function(){var f=this.words,e=this.sigBytes;f[e>>>2]&=4294967295<<32-8*(e%4);f.length=t.ceil(e/4)},clone:function(){var b=n.clone.call(this);b.words=this.words.slice(0);return b},random:function(f){for(var e=[],g=0;g<f;g+=4){e.push(4294967296*t.random()|0)}return p.create(e,f)}}),d=w.enc={},j=d.Hex={stringify:function(g){for(var f=g.words,g=g.sigBytes,i=[],k=0;k<g;k++){var h=f[k>>>2]>>>24-8*(k%4)&255;i.push((h>>>4).toString(16));i.push((h&15).toString(16))}return i.join("")},parse:function(f){for(var e=f.length,g=[],h=0;h<e;h+=2){g[h>>>3]|=parseInt(f.substr(h,2),16)<<24-4*(h%8)}return p.create(g,e/2)}},c=d.Latin1={stringify:function(f){for(var e=f.words,f=f.sigBytes,g=[],h=0;h<f;h++){g.push(String.fromCharCode(e[h>>>2]>>>24-8*(h%4)&255))}return g.join("")},parse:function(f){for(var e=f.length,g=[],h=0;h<e;h++){g[h>>>2]|=(f.charCodeAt(h)&255)<<24-8*(h%4)}return p.create(g,e)}},a=d.Utf8={stringify:function(f){try{return decodeURIComponent(escape(c.stringify(f)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(b){return c.parse(unescape(encodeURIComponent(b)))}},x=v.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=p.create();this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=a.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(i){var h=this._data,o=h.words,q=h.sigBytes,m=this.blockSize,k=q/(4*m),k=i?t.ceil(k):t.max((k|0)-this._minBufferSize,0),i=k*m,q=t.min(4*i,q);if(i){for(var l=0;l<i;l+=m){this._doProcessBlock(o,l)}l=o.splice(0,i);h.sigBytes-=q}return p.create(l,q)},clone:function(){var b=n.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});v.Hasher=x.extend({init:function(){this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);this._doFinalize();return this._hash},clone:function(){var b=x.clone.call(this);b._hash=this._hash.clone();return b},blockSize:16,_createHelper:function(b){return function(e,f){return b.create(f).finalize(e)}},_createHmacHelper:function(b){return function(e,f){return u.HMAC.create(b,f).finalize(e)}}});var u=w.algo={};return w}(Math);(function(g){var d=CryptoJS,n=d.lib,j=n.WordArray,n=n.Hasher,b=d.algo,c=[],p=[];(function(){function l(f){for(var e=g.sqrt(f),m=2;m<=e;m++){if(!(f%m)){return !1}}return !0}function k(e){return 4294967296*(e-(e|0))|0}for(var h=2,i=0;64>i;){l(h)&&(8>i&&(c[i]=k(g.pow(h,0.5))),p[i]=k(g.pow(h,1/3)),i++),h++}})();var a=[],b=b.SHA256=n.extend({_doReset:function(){this._hash=j.create(c.slice(0))},_doProcessBlock:function(x,w){for(var A=this._hash.words,v=A[0],B=A[1],s=A[2],y=A[3],z=A[4],u=A[5],q=A[6],r=A[7],o=0;64>o;o++){if(16>o){a[o]=x[w+o]|0}else{var t=a[o-15],m=a[o-2];a[o]=((t<<25|t>>>7)^(t<<14|t>>>18)^t>>>3)+a[o-7]+((m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10)+a[o-16]}t=r+((z<<26|z>>>6)^(z<<21|z>>>11)^(z<<7|z>>>25))+(z&u^~z&q)+p[o]+a[o];m=((v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22))+(v&B^v&s^B&s);r=q;q=u;u=z;z=y+t|0;y=s;s=B;B=v;v=t+m|0}A[0]=A[0]+v|0;A[1]=A[1]+B|0;A[2]=A[2]+s|0;A[3]=A[3]+y|0;A[4]=A[4]+z|0;A[5]=A[5]+u|0;A[6]=A[6]+q|0;A[7]=A[7]+r|0},_doFinalize:function(){var l=this._data,k=l.words,h=8*this._nDataBytes,i=8*l.sigBytes;k[i>>>5]|=128<<24-i%32;k[(i+64>>>9<<4)+15]=h;l.sigBytes=4*k.length;this._process()}});d.SHA256=n._createHelper(b);d.HmacSHA256=n._createHmacHelper(b)})(Math);(function(){var b=CryptoJS,a=b.enc.Utf8;b.algo.HMAC=b.lib.Base.extend({init:function(p,n){p=this._hasher=p.create();"string"==typeof n&&(n=a.parse(n));var l=p.blockSize,j=4*l;n.sigBytes>j&&(n=p.finalize(n));for(var g=this._oKey=n.clone(),i=this._iKey=n.clone(),d=g.words,c=i.words,s=0;s<l;s++){d[s]^=1549556828,c[s]^=909522486}g.sigBytes=i.sigBytes=j;this.reset()},reset:function(){var c=this._hasher;c.reset();c.update(this._iKey)},update:function(c){this._hasher.update(c);return this},finalize:function(d){var c=this._hasher,d=c.finalize(d);c.reset();return c.finalize(this._oKey.clone().concat(d))}})})();(function(){var b=CryptoJS,a=b.lib.WordArray;b.enc.Base64={stringify:function(h){var l=h.words,k=h.sigBytes,n=this._map;h.clamp();for(var h=[],i=0;i<k;i+=3){for(var m=(l[i>>>2]>>>24-8*(i%4)&255)<<16|(l[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|l[i+2>>>2]>>>24-8*((i+2)%4)&255,j=0;4>j&&i+0.75*j<k;j++){h.push(n.charAt(m>>>6*(3-j)&63))}}if(l=n.charAt(64)){for(;h.length%4;){h.push(l)}}return h.join("")},parse:function(i){var i=i.replace(/\s/g,""),n=i.length,m=this._map,p=m.charAt(64);p&&(p=i.indexOf(p),-1!=p&&(n=p));for(var p=[],j=0,o=0;o<n;o++){if(o%4){var l=m.indexOf(i.charAt(o-1))<<2*(o%4),k=m.indexOf(i.charAt(o))>>>6-2*(o%4);p[j>>>2]|=(l|k)<<24-8*(j%4);j++}}return a.create(p,j)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();